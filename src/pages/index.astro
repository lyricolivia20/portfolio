---
import Layout from '../layouts/Layout.astro';

const projects = [
  {
    name: 'LyriCodes.com',
    description: 'Cyberpunk-inspired portfolio hub for AI/web development work',
    tech: ['Three.js', 'React', 'WebGL'],
    status: 'active',
    link: '#'
  },
  {
    name: 'WhereTF',
    description: 'ADHD-friendly lost-item finder app with sarcastic mascot "Lil Void"',
    tech: ['React Native', 'Expo', 'Firebase'],
    status: 'beta',
    link: '#'
  },
  {
    name: 'Neonix',
    description: 'Cyber-fantasy RPG game prototype moving toward VR/Unity builds',
    tech: ['Unity', 'C#', 'A-Frame', 'Three.js'],
    status: 'prototype',
    link: '#'
  },
  {
    name: 'Cove',
    description: 'Custom personal LLM functioning as memory and data insight engine',
    tech: ['Python', 'Mistral', 'FastAPI'],
    status: 'development',
    link: '#'
  },
  {
    name: 'Text-to-3D Pipeline',
    description: 'Automation process for generating 3D assets from AI images',
    tech: ['Stable Diffusion', 'Tripo3D', 'DeepMotion'],
    status: 'development',
    link: '#'
  },
  {
    name: 'SNHUAgenda',
    description: 'Automated academic planner that scrapes syllabus content',
    tech: ['Python', 'Playwright', 'Automation'],
    status: 'development',
    link: '#'
  }
];

const techStack = {
  languages: {
    title: 'Languages',
    icon: '{ }',
    items: [
      { name: 'Python', desc: 'ML, backend, automation', primary: true },
      { name: 'JavaScript/TS', desc: 'Web & mobile', primary: true },
      { name: 'C#', desc: 'Unity game dev', primary: false },
      { name: 'SQL', desc: 'Database queries', primary: false }
    ]
  },
  frontend: {
    title: 'Frontend',
    icon: '< >',
    items: [
      { name: 'React/RN', desc: 'UI & mobile apps', primary: true },
      { name: 'Three.js', desc: '3D web graphics', primary: true },
      { name: 'Astro', desc: 'Static sites', primary: false },
      { name: 'TailwindCSS', desc: 'Styling', primary: false }
    ]
  },
  backend: {
    title: 'Backend',
    icon: '[ ]',
    items: [
      { name: 'FastAPI/Flask', desc: 'Python APIs', primary: true },
      { name: 'Firebase', desc: 'Cloud & auth', primary: true },
      { name: 'MongoDB', desc: 'NoSQL database', primary: false },
      { name: 'Node.js', desc: 'JS runtime', primary: false }
    ]
  },
  ai: {
    title: 'AI/ML',
    icon: '‚óà',
    items: [
      { name: 'Stable Diffusion', desc: 'Image generation', primary: true },
      { name: 'Mistral/Mixtral', desc: 'Local LLMs', primary: true },
      { name: 'OpenAI API', desc: 'GPT-4 integration', primary: true },
      { name: 'Hugging Face', desc: 'Open models', primary: false }
    ]
  },
  tools: {
    title: 'DevOps',
    icon: '‚öô',
    items: [
      { name: 'Git/GitHub', desc: 'Version control', primary: true },
      { name: 'Docker', desc: 'Containers', primary: false },
      { name: 'Playwright', desc: 'Web scraping', primary: true },
      { name: 'VS Code', desc: 'Editor', primary: true }
    ]
  }
};

const experience = [
  {
    title: 'Full-Stack Developer',
    type: 'Independent',
    period: '2022 - Present',
    highlights: [
      'Building AI-powered web applications and mobile apps',
      'Developing VR/AR prototypes with Unity and Three.js',
      'Creating automated content pipelines with Stable Diffusion'
    ]
  },
  {
    title: 'AI Data & Research',
    type: 'Contract',
    period: '2020 - 2022',
    highlights: [
      'AI data annotation and model evaluation (Appen, Figure8)',
      'Web evaluation and market research projects',
      'Quality assurance for ML training datasets'
    ]
  }
];

const statusColors: Record<string, string> = {
  active: 'emerald',
  beta: 'cyan',
  development: 'amber',
  prototype: 'violet'
};
---

<Layout title="LyriCodes | Full-Stack Developer & AI Engineer">
  <div class="min-h-screen">
    <!-- Scroll Progress Indicator -->
    <div id="scroll-progress" class="fixed top-0 left-0 h-[2px] bg-gradient-to-r from-pink-500 via-violet-500 to-cyan-500 z-[60] transition-all duration-75" style="width: 0%"></div>

    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-zinc-950/80 backdrop-blur-md border-b border-zinc-800/50">
      <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
        <a href="/" class="flex items-center gap-4 group logo-container">
          <div class="logo-icon w-12 h-12 rounded-xl bg-gradient-to-br from-pink-500/20 via-violet-500/20 to-cyan-500/20 border border-pink-500/30 flex items-center justify-center group-hover:border-pink-500/60 transition-all duration-300 group-hover:shadow-[0_0_20px_rgba(255,6,157,0.3)]">
            <span class="font-mono font-bold text-lg text-pink-400 group-hover:scale-110 transition-transform">LC</span>
          </div>
          <div class="flex flex-col">
            <span class="logo-text text-xl font-bold bg-gradient-to-r from-zinc-100 via-pink-300 to-zinc-100 bg-clip-text text-transparent bg-[length:200%_auto] animate-shimmer">LyriCodes</span>
            <span class="text-zinc-500 text-xs font-mono tracking-wider">Full-Stack Developer</span>
          </div>
        </a>
        <div class="flex items-center gap-6">
          <a href="#projects" class="nav-link text-sm font-mono hidden sm:block">projects</a>
          <a href="#stack" class="nav-link text-sm font-mono hidden sm:block">stack</a>
          <a href="#experience" class="nav-link text-sm font-mono hidden sm:block">experience</a>
          <button id="terminal-toggle" class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-pink-500/10 border border-pink-500/30 text-pink-400 text-sm font-mono hover:bg-pink-500/20 hover:border-pink-500/50 transition-all">
            <span class="w-2 h-2 rounded-full bg-pink-400 animate-pulse"></span>
            terminal
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-24 pb-20 px-6">
      <div class="max-w-6xl mx-auto">
        
        <!-- Hero Section -->
        <section class="py-16 md:py-24">
          <div class="max-w-3xl">
            <p class="text-pink-400 font-mono text-sm mb-4 tracking-wider">// HELLO WORLD</p>
            <h1 class="text-4xl md:text-6xl font-bold text-zinc-100 mb-6 leading-tight">
              I build <span class="gradient-text">intelligent</span> digital experiences
            </h1>
            <p class="text-lg text-zinc-400 leading-relaxed mb-8">
              Full-stack developer specializing in AI integration, 3D web graphics, and mobile applications. 
              I transform complex ideas into elegant, functional software.
            </p>
            <div class="flex flex-wrap gap-4">
              <a href="#projects" class="magnetic-btn px-6 py-3 bg-pink-500/10 border border-pink-500/30 rounded-lg text-pink-400 font-medium hover:bg-pink-500/20 hover:border-pink-500/50 transition-all duration-200 hover:shadow-[0_0_20px_rgba(255,6,157,0.2)]">
                View Projects
              </a>
              <a href="#contact" class="magnetic-btn px-6 py-3 bg-zinc-800/50 border border-zinc-700 rounded-lg text-zinc-300 font-medium hover:border-zinc-600 hover:text-zinc-100 transition-all duration-200 hover:shadow-[0_0_15px_rgba(255,255,255,0.05)]">
                Get in Touch
              </a>
            </div>
          </div>
        </section>

        <!-- Projects Section -->
        <section id="projects" class="py-16 scroll-mt-24">
          <div class="flex items-center gap-4 mb-8">
            <span class="text-emerald-400 font-mono text-sm">01</span>
            <h2 class="text-2xl font-bold text-zinc-100">Featured Projects</h2>
            <div class="flex-1 h-px bg-gradient-to-r from-emerald-500/50 to-transparent"></div>
          </div>
          
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
            {projects.map((project, i) => (
              <article class="group glass-card p-5 section-card" style={`animation-delay: ${i * 0.1}s`}>
                <div class="flex items-start justify-between mb-3">
                  <h3 class="font-semibold text-zinc-100 group-hover:text-pink-400 transition-colors">{project.name}</h3>
                  <span class={`text-[10px] px-2 py-0.5 rounded font-mono bg-${statusColors[project.status]}-500/10 text-${statusColors[project.status]}-400 border border-${statusColors[project.status]}-500/20`}>
                    {project.status}
                  </span>
                </div>
                <p class="text-zinc-500 text-sm mb-4 leading-relaxed">{project.description}</p>
                <div class="flex flex-wrap gap-1.5">
                  {project.tech.map((t) => (
                    <span class="tag">{t}</span>
                  ))}
                </div>
              </article>
            ))}
          </div>
        </section>

        <!-- Tech Stack Section - Interactive Constellation -->
        <section id="stack" class="py-16 scroll-mt-24">
          <div class="flex items-center gap-4 mb-8">
            <span class="text-cyan-400 font-mono text-sm">02</span>
            <h2 class="text-2xl font-bold text-zinc-100">Tech Stack</h2>
            <div class="flex-1 h-px bg-gradient-to-r from-cyan-500/50 to-transparent"></div>
          </div>

          <!-- Constellation Container -->
          <div class="constellation-wrapper relative">
            <canvas id="constellation-canvas" class="w-full h-[500px] md:h-[600px]"></canvas>
            
            <!-- Floating Skill Tooltip -->
            <div id="skill-tooltip" class="absolute pointer-events-none opacity-0 transition-all duration-200 z-30">
              <div class="glass-card p-4 min-w-[250px] max-w-[300px] border-pink-500/30">
                <div class="flex items-center gap-3 mb-2">
                  <span id="tooltip-icon" class="text-2xl"></span>
                  <div>
                    <h4 id="tooltip-name" class="font-bold text-zinc-100"></h4>
                    <span id="tooltip-category" class="text-pink-400 font-mono text-xs"></span>
                  </div>
                </div>
                <p id="tooltip-desc" class="text-zinc-400 text-sm leading-relaxed mb-3"></p>
                <div id="tooltip-tags" class="flex flex-wrap gap-1.5"></div>
              </div>
            </div>

            <!-- Legend -->
            <div class="absolute bottom-4 left-4 flex flex-wrap gap-4 text-xs font-mono">
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-pink-400 shadow-[0_0_8px_rgba(255,6,157,0.6)]"></span>
                <span class="text-zinc-500">Languages</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-cyan-400 shadow-[0_0_8px_rgba(34,211,238,0.6)]"></span>
                <span class="text-zinc-500">Frameworks</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-violet-400 shadow-[0_0_8px_rgba(167,139,250,0.6)]"></span>
                <span class="text-zinc-500">Tools & Platforms</span>
              </div>
            </div>

            <!-- Instruction hint -->
            <div class="absolute top-4 right-4 text-zinc-600 text-xs font-mono">
              <span class="hidden md:inline">hover to explore ‚Ä¢ </span>connections show tech relationships
            </div>
          </div>

          <!-- Stats Row -->
          <div class="grid grid-cols-4 gap-3 mt-6">
            <div class="glass-card p-4 text-center group hover:border-pink-500/40 transition-colors">
              <span class="text-2xl font-bold text-pink-400 group-hover:scale-110 inline-block transition-transform">5</span>
              <p class="text-zinc-500 text-xs font-mono mt-1">Languages</p>
            </div>
            <div class="glass-card p-4 text-center group hover:border-cyan-500/40 transition-colors">
              <span class="text-2xl font-bold text-cyan-400 group-hover:scale-110 inline-block transition-transform">8</span>
              <p class="text-zinc-500 text-xs font-mono mt-1">Frameworks</p>
            </div>
            <div class="glass-card p-4 text-center group hover:border-violet-500/40 transition-colors">
              <span class="text-2xl font-bold text-violet-400 group-hover:scale-110 inline-block transition-transform">6</span>
              <p class="text-zinc-500 text-xs font-mono mt-1">Tools</p>
            </div>
            <div class="glass-card p-4 text-center group hover:border-emerald-500/40 transition-colors">
              <span class="text-2xl font-bold text-emerald-400 group-hover:scale-110 inline-block transition-transform">3+</span>
              <p class="text-zinc-500 text-xs font-mono mt-1">Years</p>
            </div>
          </div>
        </section>

        <!-- Experience Section -->
        <section id="experience" class="py-16 scroll-mt-24">
          <div class="flex items-center gap-4 mb-8">
            <span class="text-violet-400 font-mono text-sm">03</span>
            <h2 class="text-2xl font-bold text-zinc-100">Experience</h2>
            <div class="flex-1 h-px bg-gradient-to-r from-violet-500/50 to-transparent"></div>
          </div>

          <div class="space-y-6 max-w-3xl">
            {experience.map((exp, i) => (
              <div class="glass-card p-6 section-card" style={`animation-delay: ${i * 0.15}s`}>
                <div class="flex flex-wrap items-start justify-between gap-2 mb-4">
                  <div>
                    <h3 class="font-semibold text-zinc-100 text-lg">{exp.title}</h3>
                    <p class="text-pink-400 font-mono text-sm">{exp.type}</p>
                  </div>
                  <span class="text-zinc-500 font-mono text-sm">{exp.period}</span>
                </div>
                <ul class="space-y-2">
                  {exp.highlights.map((h) => (
                    <li class="flex items-start gap-3 text-zinc-400 text-sm">
                      <span class="text-emerald-400 mt-1">‚ñπ</span>
                      {h}
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-16 scroll-mt-24">
          <div class="flex items-center gap-4 mb-8">
            <span class="text-pink-400 font-mono text-sm">04</span>
            <h2 class="text-2xl font-bold text-zinc-100">Get in Touch</h2>
            <div class="flex-1 h-px bg-gradient-to-r from-pink-500/50 to-transparent"></div>
          </div>

          <div class="max-w-2xl">
            <p class="text-zinc-400 leading-relaxed mb-8">
              Interested in collaborating on a project, have questions, or just want to connect? 
              I'm always open to discussing new opportunities and ideas.
            </p>
            <div class="flex flex-wrap gap-4">
              <a href="mailto:lyric.jensen@snhu.edu" class="flex items-center gap-3 px-5 py-3 bg-pink-500/10 border border-pink-500/30 rounded-lg text-pink-400 font-mono text-sm hover:bg-pink-500/20 hover:border-pink-500/50 transition-all">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                lyric.jensen@snhu.edu
              </a>
              <a href="https://github.com/lyricolivia20" target="_blank" rel="noopener" class="flex items-center gap-3 px-5 py-3 bg-zinc-800/50 border border-zinc-700 rounded-lg text-zinc-300 font-mono text-sm hover:border-zinc-600 hover:text-zinc-100 transition-all">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                GitHub
              </a>
              <a href="https://www.linkedin.com/in/lyric-jensen-720487164/" target="_blank" rel="noopener" class="flex items-center gap-3 px-5 py-3 bg-zinc-800/50 border border-zinc-700 rounded-lg text-zinc-300 font-mono text-sm hover:border-zinc-600 hover:text-zinc-100 transition-all">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                LinkedIn
              </a>
            </div>
          </div>
        </section>

      </div>
    </main>

    <!-- Sticky Side Section Nav (Desktop only) -->
    <nav id="section-nav" class="hidden lg:flex fixed right-6 top-1/2 -translate-y-1/2 flex-col items-end gap-2 z-40">
      <!-- Top collapse line -->
      <div class="nav-line-top w-px h-8 bg-gradient-to-b from-transparent to-zinc-700 transition-all duration-500"></div>
      
      <a href="#projects" data-section="projects" class="section-nav-link transition-all duration-500 ease-out text-right cursor-pointer">
        <span class="nav-label font-mono whitespace-nowrap tracking-tight transition-all duration-300 text-sm text-zinc-600">projects</span>
      </a>
      <a href="#stack" data-section="stack" class="section-nav-link transition-all duration-500 ease-out text-right cursor-pointer">
        <span class="nav-label font-mono whitespace-nowrap tracking-tight transition-all duration-300 text-sm text-zinc-600">stack</span>
      </a>
      <a href="#experience" data-section="experience" class="section-nav-link transition-all duration-500 ease-out text-right cursor-pointer">
        <span class="nav-label font-mono whitespace-nowrap tracking-tight transition-all duration-300 text-sm text-zinc-600">experience</span>
      </a>
      <a href="#contact" data-section="contact" class="section-nav-link transition-all duration-500 ease-out text-right cursor-pointer">
        <span class="nav-label font-mono whitespace-nowrap tracking-tight transition-all duration-300 text-sm text-zinc-600">contact</span>
      </a>
      
      <!-- Bottom collapse line -->
      <div class="nav-line-bottom w-px h-8 bg-gradient-to-t from-transparent to-zinc-700 transition-all duration-500"></div>
    </nav>

    <!-- Minimizable Terminal -->
    <div id="terminal-container" class="fixed bottom-6 right-6 z-40 w-full max-w-lg transition-all duration-300 ease-out translate-y-[calc(100%+2rem)] opacity-0">
      <div class="terminal-wrapper shadow-2xl">
        <div class="terminal-header cursor-move" id="terminal-drag-handle">
          <div class="flex items-center gap-2">
            <button id="terminal-close" class="terminal-dot dot-red hover:scale-110 transition-transform cursor-pointer" title="Close"></button>
            <button id="terminal-minimize" class="terminal-dot dot-yellow hover:scale-110 transition-transform cursor-pointer" title="Minimize"></button>
            <div class="terminal-dot dot-green"></div>
          </div>
          <span class="ml-4 text-xs text-zinc-500 font-mono flex-1">lyricodes@portfolio ~ </span>
          <button id="terminal-expand" class="text-zinc-500 hover:text-zinc-300 transition-colors p-1" title="Toggle size">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
            </svg>
          </button>
        </div>

        <div id="terminal-body" class="transition-all duration-300 ease-out">
          <div id="terminal-output" class="terminal-output"></div>

          <div class="terminal-input-wrapper">
            <span class="prompt">‚ùØ</span>
            <input 
              id="terminal-input" 
              type="text" 
              class="terminal-input"
              placeholder="Type 'help' for commands..."
              autocomplete="off"
              spellcheck="false"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="border-t border-zinc-800/50 bg-zinc-950/80 backdrop-blur-sm">
      <div class="max-w-6xl mx-auto px-6 py-8 flex flex-col md:flex-row items-center justify-between gap-4">
        <p class="text-zinc-500 text-sm font-mono">¬© 2025 LyriCodes. Built with Astro + TailwindCSS</p>
        <div class="flex items-center gap-4 text-zinc-500">
          <a href="/rss.xml" class="hover:text-pink-400 transition-colors" title="RSS">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z"/></svg>
          </a>
        </div>
      </div>
    </footer>
  </div>

  <script>
    // Terminal state
    let terminalOpen = false;
    let terminalMinimized = false;
    let terminalExpanded = false;

    const terminalContainer = document.getElementById('terminal-container')!;
    const terminalBody = document.getElementById('terminal-body')!;
    const terminalToggle = document.getElementById('terminal-toggle')!;
    const terminalClose = document.getElementById('terminal-close')!;
    const terminalMinimize = document.getElementById('terminal-minimize')!;
    const terminalExpand = document.getElementById('terminal-expand')!;
    const output = document.getElementById('terminal-output')!;
    const input = document.getElementById('terminal-input') as HTMLInputElement;

    function openTerminal() {
      terminalOpen = true;
      terminalMinimized = false;
      terminalContainer.classList.remove('translate-y-[calc(100%+2rem)]', 'opacity-0');
      terminalContainer.classList.add('translate-y-0', 'opacity-100');
      terminalBody.style.height = '';
      terminalBody.style.overflow = '';
      setTimeout(() => input.focus(), 300);
    }

    function closeTerminal() {
      terminalOpen = false;
      terminalContainer.classList.add('translate-y-[calc(100%+2rem)]', 'opacity-0');
      terminalContainer.classList.remove('translate-y-0', 'opacity-100');
    }

    function minimizeTerminal() {
      terminalMinimized = !terminalMinimized;
      if (terminalMinimized) {
        terminalBody.style.height = '0';
        terminalBody.style.overflow = 'hidden';
      } else {
        terminalBody.style.height = '';
        terminalBody.style.overflow = '';
        setTimeout(() => input.focus(), 100);
      }
    }

    function expandTerminal() {
      terminalExpanded = !terminalExpanded;
      if (terminalExpanded) {
        terminalContainer.classList.remove('max-w-lg');
        terminalContainer.classList.add('max-w-3xl');
        output.style.height = '400px';
      } else {
        terminalContainer.classList.add('max-w-lg');
        terminalContainer.classList.remove('max-w-3xl');
        output.style.height = '';
      }
    }

    terminalToggle.addEventListener('click', () => {
      if (terminalOpen) {
        closeTerminal();
      } else {
        openTerminal();
      }
    });

    terminalClose.addEventListener('click', closeTerminal);
    terminalMinimize.addEventListener('click', minimizeTerminal);
    terminalExpand.addEventListener('click', expandTerminal);

    // Terminal commands
    function addLine(text: string, className = '') {
      const line = document.createElement('div');
      line.className = className;
      line.innerHTML = text;
      output.appendChild(line);
      output.scrollTop = output.scrollHeight;
    }

    const commands: Record<string, () => void> = {
      help: () => {
        addLine('');
        addLine('<span class="cmd-info">Available Commands:</span>');
        addLine('  <span class="cmd-accent">whoami</span>     <span class="cmd-muted">‚Äî About me</span>');
        addLine('  <span class="cmd-accent">skills</span>     <span class="cmd-muted">‚Äî Technical skills</span>');
        addLine('  <span class="cmd-accent">projects</span>   <span class="cmd-muted">‚Äî Featured work</span>');
        addLine('  <span class="cmd-accent">contact</span>    <span class="cmd-muted">‚Äî Get in touch</span>');
        addLine('  <span class="cmd-accent">resume</span>     <span class="cmd-muted">‚Äî Download CV</span>');
        addLine('  <span class="cmd-accent">theme</span>      <span class="cmd-muted">‚Äî Toggle matrix intensity</span>');
        addLine('  <span class="cmd-accent">clear</span>      <span class="cmd-muted">‚Äî Clear terminal</span>');
        addLine('');
      },
      whoami: () => {
        addLine('');
        addLine('<span class="cmd-success">LyriCodes</span> ‚Äî Full-Stack Developer & AI Engineer');
        addLine('');
        addLine('I build intelligent digital experiences at the intersection of');
        addLine('AI, game development, and web technologies.');
        addLine('');
        addLine('<span class="cmd-muted">Focus areas:</span>');
        addLine('  ‚Ä¢ AI/ML integration & automation');
        addLine('  ‚Ä¢ 3D web graphics (Three.js, WebGL)');
        addLine('  ‚Ä¢ Mobile app development (React Native)');
        addLine('  ‚Ä¢ Game prototyping (Unity, VR)');
        addLine('');
      },
      skills: () => {
        addLine('');
        addLine('<span class="cmd-info">Technical Skills:</span>');
        addLine('');
        addLine('<span class="cmd-accent">Languages:</span>  Python, JavaScript/TS, C#, SQL');
        addLine('<span class="cmd-accent">Frontend:</span>   React, Three.js, Astro, TailwindCSS');
        addLine('<span class="cmd-accent">Backend:</span>    FastAPI, Flask, Firebase, MongoDB');
        addLine('<span class="cmd-accent">AI/ML:</span>      Stable Diffusion, Mistral, OpenAI, HuggingFace');
        addLine('<span class="cmd-accent">DevOps:</span>     Git, Docker, Playwright, Linux');
        addLine('');
      },
      projects: () => {
        addLine('');
        addLine('<span class="cmd-info">Featured Projects:</span>');
        addLine('');
        addLine('<span class="cmd-success">‚ñπ LyriCodes.com</span> ‚Äî Cyberpunk portfolio (Three.js, React)');
        addLine('<span class="cmd-success">‚ñπ WhereTF</span> ‚Äî ADHD item finder app (React Native, Firebase)');
        addLine('<span class="cmd-success">‚ñπ Neonix</span> ‚Äî Cyber-fantasy RPG prototype (Unity, C#)');
        addLine('<span class="cmd-success">‚ñπ Cove</span> ‚Äî Personal LLM engine (Python, Mistral)');
        addLine('<span class="cmd-success">‚ñπ Text-to-3D</span> ‚Äî AI asset pipeline (Stable Diffusion)');
        addLine('');
        addLine('<span class="cmd-muted">Scroll up to see full project cards ‚Üë</span>');
        addLine('');
      },
      contact: () => {
        addLine('');
        addLine('<span class="cmd-info">Contact Information:</span>');
        addLine('');
        addLine('<span class="cmd-accent">Email:</span>    lyric.jensen@snhu.edu');
        addLine('<span class="cmd-accent">GitHub:</span>   github.com/lyricolivia20');
        addLine('<span class="cmd-accent">LinkedIn:</span> linkedin.com/in/lyric-jensen-720487164');
        addLine('');
        addLine('<span class="cmd-muted">Open to freelance and collaboration opportunities.</span>');
        addLine('');
      },
      resume: () => {
        addLine('');
        addLine('<span class="cmd-success">Preparing resume download...</span>');
        addLine('<span class="cmd-muted">(Resume PDF would download here)</span>');
        addLine('');
      },
      theme: () => {
        const canvas = document.getElementById('matrix-canvas')!;
        const current = parseFloat(canvas.style.opacity) || 0.5;
        const next = current > 0.6 ? 0.3 : 0.8;
        canvas.style.opacity = String(next);
        addLine('');
        addLine(`<span class="cmd-success">Matrix intensity: ${Math.round(next * 100)}%</span>`);
        addLine('');
      },
      clear: () => {
        output.innerHTML = '';
      },
      ls: () => {
        addLine('');
        addLine('<span class="cmd-muted">drwxr-xr-x</span>  projects/');
        addLine('<span class="cmd-muted">drwxr-xr-x</span>  skills/');
        addLine('<span class="cmd-muted">-rw-r--r--</span>  about.md');
        addLine('<span class="cmd-muted">-rw-r--r--</span>  resume.pdf');
        addLine('');
      },
      pwd: () => {
        addLine('');
        addLine('/home/lyricodes/portfolio');
        addLine('');
      },
      date: () => {
        addLine('');
        addLine(new Date().toString());
        addLine('');
      },
      neofetch: () => {
        addLine('');
        addLine('<span class="cmd-accent">       ‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó</span>');
        addLine('<span class="cmd-accent">       ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù</span>   <span class="cmd-success">LyriCodes</span>@portfolio');
        addLine('<span class="cmd-accent">       ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë</span>      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');
        addLine('<span class="cmd-accent">       ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó</span>  <span class="cmd-muted">OS:</span> Astro 5.x');
        addLine('<span class="cmd-accent">       ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù</span>  <span class="cmd-muted">Shell:</span> Terminal v3.0');
        addLine('                        <span class="cmd-muted">Theme:</span> Cyberpunk Pink');
        addLine('                        <span class="cmd-muted">Stack:</span> TS, Python, C#');
        addLine('');
      }
    };

    // Welcome message
    addLine('<span class="cmd-info">LyriCodes Terminal v3.0</span>');
    addLine('<span class="cmd-muted">Type "help" for available commands.</span>');
    addLine('');

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const cmd = input.value.trim().toLowerCase();
        if (cmd) {
          addLine(`<span class="cmd-accent">‚ùØ</span> ${cmd}`);
          if (commands[cmd]) {
            commands[cmd]();
          } else {
            addLine(`<span class="cmd-muted">Command not found: ${cmd}</span>`);
            addLine('<span class="cmd-muted">Type "help" for available commands.</span>');
            addLine('');
          }
        }
        input.value = '';
      }
    });

    // Keyboard shortcut to toggle terminal
    document.addEventListener('keydown', (e) => {
      if (e.key === '`' && (e.metaKey || e.ctrlKey)) {
        e.preventDefault();
        if (terminalOpen) {
          closeTerminal();
        } else {
          openTerminal();
        }
      }
      // Escape to close
      if (e.key === 'Escape' && terminalOpen) {
        closeTerminal();
      }
    });

    // Scroll progress indicator
    const scrollProgress = document.getElementById('scroll-progress')!;
    window.addEventListener('scroll', () => {
      const scrollTop = window.scrollY;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const progress = (scrollTop / docHeight) * 100;
      scrollProgress.style.width = `${progress}%`;
    });

    // Intersection Observer for staggered reveal animations
    const observerOptions = {
      root: null,
      rootMargin: '0px 0px -50px 0px',
      threshold: 0.1
    };

    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach((entry, index) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('revealed');
          revealObserver.unobserve(entry.target);
        }
      });
    }, observerOptions);

    document.querySelectorAll('.section-card, .glass-card').forEach((el) => {
      revealObserver.observe(el);
    });

    // Magnetic hover effect for buttons
    document.querySelectorAll('.magnetic-btn').forEach((btn) => {
      btn.addEventListener('mousemove', (e: Event) => {
        const mouseEvent = e as MouseEvent;
        const rect = (btn as HTMLElement).getBoundingClientRect();
        const x = mouseEvent.clientX - rect.left - rect.width / 2;
        const y = mouseEvent.clientY - rect.top - rect.height / 2;
        (btn as HTMLElement).style.transform = `translate(${x * 0.15}px, ${y * 0.15}px)`;
      });
      btn.addEventListener('mouseleave', () => {
        (btn as HTMLElement).style.transform = '';
      });
    });

    // Smooth section navigation with active state
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.nav-link');
    
    const sectionObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const id = entry.target.getAttribute('id');
          navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${id}`) {
              link.classList.add('active');
            }
          });
        }
      });
    }, { rootMargin: '-40% 0px -60% 0px' });

    sections.forEach(section => sectionObserver.observe(section));

    // ========================================
    // CONSTELLATION TECH STACK VISUALIZATION
    // ========================================
    const constellationCanvas = document.getElementById('constellation-canvas') as HTMLCanvasElement;
    const constellationCtx = constellationCanvas.getContext('2d')!;
    const tooltip = document.getElementById('skill-tooltip')!;
    const tooltipIcon = document.getElementById('tooltip-icon')!;
    const tooltipName = document.getElementById('tooltip-name')!;
    const tooltipCategory = document.getElementById('tooltip-category')!;
    const tooltipDesc = document.getElementById('tooltip-desc')!;
    const tooltipTags = document.getElementById('tooltip-tags')!;

    // Skill node data with positions, connections, and info
    interface SkillNode {
      id: string;
      name: string;
      icon: string;
      category: 'language' | 'framework' | 'tool';
      desc: string;
      tags: string[];
      x: number;
      y: number;
      baseX: number;
      baseY: number;
      connections: string[];
      size: number;
      phase: number;
    }

    const categoryColors = {
      language: { main: '#f472b6', glow: 'rgba(244, 114, 182, 0.6)' },   // pink
      framework: { main: '#22d3ee', glow: 'rgba(34, 211, 238, 0.6)' },   // cyan
      tool: { main: '#a78bfa', glow: 'rgba(167, 139, 250, 0.6)' }        // violet
    };

    // Define skills with relative positions (0-1 range, will be scaled)
    const skillNodes: SkillNode[] = [
      // Languages (pink) - left cluster
      { id: 'python', name: 'Python', icon: 'üêç', category: 'language', desc: 'Primary language for backend, ML, and automation. Production experience with FastAPI, data pipelines, and AI integration.', tags: ['FastAPI', 'Pandas', 'PyTorch'], x: 0, y: 0, baseX: 0.15, baseY: 0.3, connections: ['fastapi', 'pytorch', 'docker'], size: 28, phase: 0 },
      { id: 'typescript', name: 'TypeScript', icon: 'üìò', category: 'language', desc: 'Strongly-typed JavaScript for scalable applications. Used across all frontend and Node.js projects.', tags: ['Strict Mode', 'Generics', 'ESNext'], x: 0, y: 0, baseX: 0.25, baseY: 0.55, connections: ['react', 'nodejs', 'astro'], size: 26, phase: 1 },
      { id: 'csharp', name: 'C#', icon: 'üéØ', category: 'language', desc: 'Object-oriented language for Unity game development and .NET applications.', tags: ['Unity', '.NET', 'LINQ'], x: 0, y: 0, baseX: 0.12, baseY: 0.7, connections: ['unity'], size: 22, phase: 2 },
      { id: 'sql', name: 'SQL', icon: 'üóÑÔ∏è', category: 'language', desc: 'Database query language for PostgreSQL, complex joins, and data analytics.', tags: ['PostgreSQL', 'Queries', 'Optimization'], x: 0, y: 0, baseX: 0.22, baseY: 0.82, connections: ['postgresql', 'mongodb'], size: 20, phase: 3 },
      { id: 'html', name: 'HTML/CSS', icon: 'üé®', category: 'language', desc: 'Semantic markup and modern CSS including Flexbox, Grid, and animations.', tags: ['Semantic', 'Flexbox', 'Grid'], x: 0, y: 0, baseX: 0.08, baseY: 0.5, connections: ['tailwind', 'react'], size: 18, phase: 4 },

      // Frameworks (cyan) - center cluster
      { id: 'react', name: 'React', icon: '‚öõÔ∏è', category: 'framework', desc: 'Component-based UI library for web and mobile apps with React Native.', tags: ['Hooks', 'Context', 'Native'], x: 0, y: 0, baseX: 0.45, baseY: 0.25, connections: ['typescript', 'tailwind', 'threejs'], size: 28, phase: 0.5 },
      { id: 'fastapi', name: 'FastAPI', icon: '‚ö°', category: 'framework', desc: 'High-performance Python API framework with automatic OpenAPI docs.', tags: ['Async', 'Pydantic', 'REST'], x: 0, y: 0, baseX: 0.38, baseY: 0.48, connections: ['python', 'postgresql', 'docker'], size: 24, phase: 1.5 },
      { id: 'astro', name: 'Astro', icon: 'üöÄ', category: 'framework', desc: 'Modern static site generator with partial hydration and island architecture.', tags: ['SSG', 'Islands', 'MDX'], x: 0, y: 0, baseX: 0.55, baseY: 0.42, connections: ['typescript', 'tailwind'], size: 22, phase: 2.5 },
      { id: 'nodejs', name: 'Node.js', icon: 'üíö', category: 'framework', desc: 'JavaScript runtime for server-side apps, APIs, and build tooling.', tags: ['Express', 'NPM', 'APIs'], x: 0, y: 0, baseX: 0.5, baseY: 0.65, connections: ['typescript', 'mongodb', 'docker'], size: 24, phase: 3.5 },
      { id: 'threejs', name: 'Three.js', icon: 'üéÆ', category: 'framework', desc: '3D graphics library for immersive WebGL experiences and visualizations.', tags: ['WebGL', 'Shaders', '3D'], x: 0, y: 0, baseX: 0.62, baseY: 0.22, connections: ['react', 'typescript'], size: 20, phase: 4.5 },
      { id: 'tailwind', name: 'Tailwind', icon: 'üí®', category: 'framework', desc: 'Utility-first CSS framework for rapid, responsive UI development.', tags: ['Utility', 'JIT', 'Responsive'], x: 0, y: 0, baseX: 0.35, baseY: 0.72, connections: ['react', 'astro', 'html'], size: 20, phase: 5 },
      { id: 'pytorch', name: 'PyTorch', icon: 'üî•', category: 'framework', desc: 'Deep learning framework for neural networks and AI model training.', tags: ['ML', 'CUDA', 'Tensors'], x: 0, y: 0, baseX: 0.28, baseY: 0.18, connections: ['python'], size: 22, phase: 5.5 },
      { id: 'unity', name: 'Unity', icon: 'üé≤', category: 'framework', desc: 'Game engine for VR/AR, mobile games, and interactive 3D applications.', tags: ['VR', 'AR', 'Games'], x: 0, y: 0, baseX: 0.18, baseY: 0.88, connections: ['csharp'], size: 20, phase: 6 },

      // Tools & Platforms (violet) - right cluster
      { id: 'docker', name: 'Docker', icon: 'üê≥', category: 'tool', desc: 'Containerization for consistent dev environments and deployment.', tags: ['Containers', 'Compose', 'CI/CD'], x: 0, y: 0, baseX: 0.75, baseY: 0.35, connections: ['fastapi', 'nodejs', 'aws'], size: 24, phase: 1 },
      { id: 'postgresql', name: 'PostgreSQL', icon: 'üêò', category: 'tool', desc: 'Advanced relational database with JSON support and complex queries.', tags: ['JSONB', 'Indexes', 'Transactions'], x: 0, y: 0, baseX: 0.68, baseY: 0.55, connections: ['fastapi', 'sql'], size: 22, phase: 2 },
      { id: 'mongodb', name: 'MongoDB', icon: 'üçÉ', category: 'tool', desc: 'NoSQL document database for flexible schemas and real-time data.', tags: ['NoSQL', 'Atlas', 'Mongoose'], x: 0, y: 0, baseX: 0.72, baseY: 0.72, connections: ['nodejs', 'sql'], size: 20, phase: 3 },
      { id: 'git', name: 'Git', icon: 'üì¶', category: 'tool', desc: 'Version control with branching strategies and CI/CD workflows.', tags: ['GitHub', 'Actions', 'PRs'], x: 0, y: 0, baseX: 0.88, baseY: 0.5, connections: ['docker'], size: 20, phase: 4 },
      { id: 'aws', name: 'AWS', icon: '‚òÅÔ∏è', category: 'tool', desc: 'Cloud services for scalable infrastructure and serverless computing.', tags: ['Lambda', 'S3', 'EC2'], x: 0, y: 0, baseX: 0.85, baseY: 0.28, connections: ['docker', 'postgresql'], size: 22, phase: 5 },
      { id: 'firebase', name: 'Firebase', icon: 'üî∂', category: 'tool', desc: 'Google platform for auth, real-time databases, and hosting.', tags: ['Auth', 'Firestore', 'Functions'], x: 0, y: 0, baseX: 0.82, baseY: 0.7, connections: ['react', 'nodejs'], size: 18, phase: 6 },
    ];

    let hoveredNode: SkillNode | null = null;
    let animationTime = 0;
    let constellationMouseX = 0;
    let constellationMouseY = 0;

    function resizeConstellationCanvas() {
      const rect = constellationCanvas.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      constellationCanvas.width = rect.width * dpr;
      constellationCanvas.height = rect.height * dpr;
      constellationCtx.scale(dpr, dpr);
      
      // Update node positions based on canvas size
      skillNodes.forEach(node => {
        node.x = node.baseX * rect.width;
        node.y = node.baseY * rect.height;
      });
    }

    function drawConstellation() {
      const rect = constellationCanvas.getBoundingClientRect();
      constellationCtx.clearRect(0, 0, rect.width, rect.height);
      
      animationTime += 0.01;

      // Draw connections first (behind nodes)
      skillNodes.forEach(node => {
        node.connections.forEach(targetId => {
          const target = skillNodes.find(n => n.id === targetId);
          if (target) {
            const isHighlighted = hoveredNode && (hoveredNode.id === node.id || hoveredNode.id === targetId);
            
            constellationCtx.beginPath();
            constellationCtx.moveTo(node.x, node.y);
            constellationCtx.lineTo(target.x, target.y);
            
            if (isHighlighted) {
              constellationCtx.strokeStyle = 'rgba(255, 6, 157, 0.5)';
              constellationCtx.lineWidth = 2;
            } else {
              constellationCtx.strokeStyle = 'rgba(255, 255, 255, 0.08)';
              constellationCtx.lineWidth = 1;
            }
            constellationCtx.stroke();

            // Animated pulse along highlighted connections
            if (isHighlighted) {
              const pulsePos = (Math.sin(animationTime * 3 + node.phase) + 1) / 2;
              const pulseX = node.x + (target.x - node.x) * pulsePos;
              const pulseY = node.y + (target.y - node.y) * pulsePos;
              
              constellationCtx.beginPath();
              constellationCtx.arc(pulseX, pulseY, 3, 0, Math.PI * 2);
              constellationCtx.fillStyle = 'rgba(255, 6, 157, 0.8)';
              constellationCtx.fill();
            }
          }
        });
      });

      // Draw nodes
      skillNodes.forEach(node => {
        const colors = categoryColors[node.category];
        const isHovered = hoveredNode?.id === node.id;
        const isConnected = hoveredNode?.connections.includes(node.id) || skillNodes.find(n => n.id === hoveredNode?.id)?.connections.includes(node.id);
        
        // Floating animation
        const floatOffset = Math.sin(animationTime + node.phase) * 3;
        const drawY = node.y + floatOffset;

        // Glow effect
        const glowSize = isHovered ? 70 : (isConnected ? 30 : 15);
        const gradient = constellationCtx.createRadialGradient(node.x, drawY, 0, node.x, drawY, glowSize);
        gradient.addColorStop(0, isHovered ? colors.glow : `${colors.main}33`);
        gradient.addColorStop(1, 'transparent');
        constellationCtx.beginPath();
        constellationCtx.arc(node.x, drawY, glowSize, 0, Math.PI * 2);
        constellationCtx.fillStyle = gradient;
        constellationCtx.fill();

        // Node circle
        const nodeSize = isHovered ? node.size * 2.2 : (isConnected ? node.size * 1.3 : node.size);
        constellationCtx.beginPath();
        constellationCtx.arc(node.x, drawY, nodeSize / 2, 0, Math.PI * 2);
        constellationCtx.fillStyle = isHovered ? colors.main : `${colors.main}cc`;
        constellationCtx.fill();
        
        // Border
        constellationCtx.strokeStyle = isHovered ? '#fff' : colors.main;
        constellationCtx.lineWidth = isHovered ? 2 : 1;
        constellationCtx.stroke();

        // Icon/emoji
        constellationCtx.font = `${isHovered ? 28 : 14}px sans-serif`;
        constellationCtx.textAlign = 'center';
        constellationCtx.textBaseline = 'middle';
        constellationCtx.fillText(node.icon, node.x, drawY);

        // Label (only on hover or for larger nodes)
        if (isHovered || node.size >= 24) {
          constellationCtx.font = `${isHovered ? 12 : 10}px "JetBrains Mono", monospace`;
          constellationCtx.fillStyle = isHovered ? '#fff' : 'rgba(255,255,255,0.6)';
          constellationCtx.fillText(node.name, node.x, drawY + nodeSize / 2 + 12);
        }
      });

      requestAnimationFrame(drawConstellation);
    }

    function handleConstellationMouseMove(e: MouseEvent) {
      const rect = constellationCanvas.getBoundingClientRect();
      constellationMouseX = e.clientX - rect.left;
      constellationMouseY = e.clientY - rect.top;

      // Check if hovering over a node
      let found: SkillNode | null = null;
      for (const node of skillNodes) {
        const floatOffset = Math.sin(animationTime + node.phase) * 3;
        const dist = Math.hypot(constellationMouseX - node.x, constellationMouseY - (node.y + floatOffset));
        if (dist < node.size) {
          found = node;
          break;
        }
      }

      if (found !== hoveredNode) {
        hoveredNode = found;
        
        if (found) {
          // Show tooltip
          tooltipIcon.textContent = found.icon;
          tooltipName.textContent = found.name;
          tooltipCategory.textContent = found.category.charAt(0).toUpperCase() + found.category.slice(1);
          tooltipDesc.textContent = found.desc;
          tooltipTags.innerHTML = found.tags.map(t => `<span class="tag text-xs">${t}</span>`).join('');
          
          tooltip.style.opacity = '1';
          constellationCanvas.style.cursor = 'pointer';
        } else {
          tooltip.style.opacity = '0';
          constellationCanvas.style.cursor = 'default';
        }
      }

      // Position tooltip
      if (hoveredNode) {
        const tooltipRect = tooltip.getBoundingClientRect();
        let tooltipX = constellationMouseX + 20;
        let tooltipY = constellationMouseY - 20;
        
        // Keep tooltip in bounds
        if (tooltipX + tooltipRect.width > rect.width) {
          tooltipX = constellationMouseX - tooltipRect.width - 20;
        }
        if (tooltipY < 0) {
          tooltipY = constellationMouseY + 20;
        }
        
        tooltip.style.left = `${tooltipX}px`;
        tooltip.style.top = `${tooltipY}px`;
      }
    }

    function handleConstellationMouseLeave() {
      hoveredNode = null;
      tooltip.style.opacity = '0';
      constellationCanvas.style.cursor = 'default';
    }

    // Initialize constellation
    resizeConstellationCanvas();
    window.addEventListener('resize', resizeConstellationCanvas);
    constellationCanvas.addEventListener('mousemove', handleConstellationMouseMove);
    constellationCanvas.addEventListener('mouseleave', handleConstellationMouseLeave);
    drawConstellation();

    // ========================================
    // SIDE NAVIGATION SCROLL SPY
    // ========================================
    const sideNavSections = ['projects', 'stack', 'experience', 'contact'];
    const sideNavLinks = document.querySelectorAll('.section-nav-link');
    
    const sideNavColorMap: Record<string, string> = {
      'projects': '#34d399',   // emerald-400
      'stack': '#22d3ee',      // cyan-400
      'experience': '#a78bfa', // violet-400
      'contact': '#f472b6'     // pink-400
    };

    let currentActiveSideNav: string | null = null;

    function setActiveSideSection(sectionId: string) {
      if (currentActiveSideNav === sectionId) return;
      currentActiveSideNav = sectionId;

      // Animate collapse lines based on active section
      const topLine = document.querySelector('.nav-line-top') as HTMLElement;
      const bottomLine = document.querySelector('.nav-line-bottom') as HTMLElement;
      
      if (topLine && bottomLine) {
        const activeIndex = sideNavSections.indexOf(sectionId);
        // Collapse lines toward active section
        if (activeIndex === 0) {
          topLine.style.height = '0.5rem';
          bottomLine.style.height = '3rem';
        } else if (activeIndex === sideNavSections.length - 1) {
          topLine.style.height = '3rem';
          bottomLine.style.height = '0.5rem';
        } else {
          const ratio = activeIndex / (sideNavSections.length - 1);
          topLine.style.height = `${0.5 + ratio * 2.5}rem`;
          bottomLine.style.height = `${3 - ratio * 2.5}rem`;
        }
        // Color the lines based on active section
        topLine.style.background = `linear-gradient(to bottom, transparent, ${sideNavColorMap[sectionId]})`;
        bottomLine.style.background = `linear-gradient(to top, transparent, ${sideNavColorMap[sectionId]})`;
      }

      sideNavLinks.forEach(link => {
        const linkSection = link.getAttribute('data-section');
        const label = link.querySelector('.nav-label') as HTMLElement;
        if (!label || !linkSection) return;
        
        if (linkSection === sectionId) {
          // Active state: bigger, colored, glowing, popped out to the LEFT
          link.classList.add('-translate-x-2');
          label.style.color = sideNavColorMap[sectionId];
          label.style.textShadow = `0 0 12px ${sideNavColorMap[sectionId]}, 0 0 24px ${sideNavColorMap[sectionId]}`;
          label.style.fontSize = '1rem';
          label.style.fontWeight = '600';
        } else {
          // Inactive state: smaller, dim, no glow
          link.classList.remove('-translate-x-2');
          label.style.color = '#52525b'; // zinc-600
          label.style.textShadow = 'none';
          label.style.fontSize = '0.75rem';
          label.style.fontWeight = '400';
        }
      });
    }

    const sideNavObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          setActiveSideSection(entry.target.id);
        }
      });
    }, {
      rootMargin: '-30% 0px -60% 0px',
      threshold: 0
    });

    sideNavSections.forEach(sectionId => {
      const section = document.getElementById(sectionId);
      if (section) sideNavObserver.observe(section);
    });

    // Hover effects for inactive side nav items
    sideNavLinks.forEach(link => {
      const linkSection = link.getAttribute('data-section');
      const label = link.querySelector('.nav-label') as HTMLElement;
      if (!label || !linkSection) return;

      link.addEventListener('mouseenter', () => {
        if (currentActiveSideNav !== linkSection) {
          label.style.color = sideNavColorMap[linkSection];
          label.style.fontSize = '0.875rem';
        }
      });

      link.addEventListener('mouseleave', () => {
        if (currentActiveSideNav !== linkSection) {
          label.style.color = '#52525b';
          label.style.fontSize = '0.75rem';
        }
      });
    });

    // Initialize first section as active on load
    setActiveSideSection('projects');
  </script>
</Layout>
